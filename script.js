const data = {
	BG: {
		10: "China",
		11: "Conical",
		12: "Dungeon",
		13: "Flatland",
		14: "Garden",
		15: "HDR Room",
		16: "Ikebana Backdrop",
		17: "It'll All Be Over",
		18: "Kimi Ni Mune Kyun",
		19: "Kings Field II",
		20: "Laminated Card",
		21: "Mega Bonkler On Earth",
		22: "Milady World",
		23: "Quest",
		24: "Shochiku Company",
		25: "Sonic 4",
		26: "Sour Grapes",
		27: "Sunflower Fields Forever",
		28: "Sunset",
		29: "Super Monkey Ball 2",
		30: "The Hole",
		31: "The Moon Zone",
		32: "Gosenzo-sama Banbanzai!",
		33: "Akiko Yano Tadaima",
		34: "Analord 11",
		35: "Aquarium",
		36: "Athens",
		37: "Banknote",
		38: "Blender Hotel Prague",
		39: "Bonkler St",
		40: "Bonkler in His Gallery",
		41: "Britney",
		42: "Cactus",
	},
	Armor: {
		10: "Harajuku Sticker",
		11: "Iron Trim",
		12: "Iron",
		13: "Jade",
		14: "Mithril Trim",
		15: "Mithril",
		16: "Phantom",
		17: "Steel Trim",
		18: "Steel",
		19: "Terminator Recolor",
		20: "Terminator",
		21: "White Trim",
		22: "White",
		23: "Adamantine Trim",
		24: "Adamantine",
		25: "Black Trim",
		26: "Black",
		27: "Bronze Trim",
		28: "Bronze",
		29: "Comme Des Garcons Homme Plus FW18 Dover Street Market Installation Dinosaur Bones",
		30: "Dragon",
		31: "Glory",
		32: "Handycam",
	},
	Head: {
		10: "Extraplanar Lens",
		11: "Fire",
		12: "Fish Shaped Ice Cream",
		13: "Flame Emoji",
		14: "GUN!!!",
		15: "GameCube",
		16: "Jiangshan Cigarettes",
		17: "Joli Cat",
		18: "Kaossilator",
		19: "Konata",
		20: "Le Creuset",
		21: "Lego Head",
		22: "Logitech MX Master 3",
		23: "Mac Aquarium",
		24: "Media Tab 06.16.22",
		25: "Media Tab 04.29.22",
		26: "Jellycat Sun",
		27: "N-Gage",
		28: "Nintendo DS",
		29: "Neuro Fuzzy",
		30: "PlayStation Vita",
		31: "SillyBandz",
		32: "Sony Egg Speaker",
		33: "Square Pretzel",
		34: "Starfish",
		35: "Mysterious",
		36: "Strawberry Hat",
		37: "Technics Record Player",
		38: "Water Hoop Game",
		39: "Wonder Vise",
		40: "YMO",
		41: "Arcade Stick",
		42: "Herring Brain Box",
		43: "iDog",
		44: "Pacemaker",
		45: "Blender Sphere",
		46: "Asus W5Fe",
		47: "Bear Statue",
		48: "Beauty:Beast CD",
		49: "Shenzen DS",
		50: "Buddha Machine",
		51: "Bwooom Cube",
		52: "Chicken Sandwich",
		53: "Dreameye",
		54: "E-Meter",
	},
	Body: {
		10: "Jade Cabbage",
		11: "Tekken King",
		12: "Burger Bonkler Laser",
		13: "Fire Bonkler Laser",
		14: "Lego Skeleton",
		15: "Noctua Heatsink",
		16: "Orion Can",
		17: "Sony PVM",
		18: "Pelican Terminal",
		19: "Sony PocketStation",
		20: "Red and Blue Chair",
		21: "Rei Lighter",
		22: "Rolliflex",
		23: "Rummikub",
		24: "Sony CD Player",
		25: "Sony Tablet",
		26: "Chinese Sprite",
		27: "Suit",
		28: "Valet Chair",
		29: "Vending Machine",
		30: "YMO Tour",
		31: "Another Freaking Mech",
		32: "#BASEDRETARDGANG Vol. 1",
		33: "Judd Chair",
		34: "Rug",
		35: "$2 Phone",
		36: "Rilakkuma",
		37: "Beetle in Resin",
		38: "Boxed Garage Kit",
		39: "Cosmic Ray Detectors",
		40: "Dark Magican Girl",
		41: "Fragile Hearts",
		42: "Guam",
		43: "Harajuku Motorola",
		44: "Jacob Jensen T3",
	},
	Face: {
		10: "Deal With It",
		11: "Evil",
		12: "Foobar",
		13: "Funko",
		14: "Gendo",
		15: "Grin",
		16: "Heh",
		17: "Jellycat",
		18: "Skele",
		19: "Star Struck",
		20: "Sunglasses",
		21: "T_T",
		22: "Telegram Duck Nerd",
		23: "Tough",
		24: "Walrus",
		25: "X",
		26: "Yotsuba Clover",
		27: "Kaomoji",
		28: "^-^",
		29: "^�^",
		30: ">_<",
		31: "n_n",
		32: "hmph!",
		33: "~.~",
		34: "�?�",
		35: "?.?",
		36: "'o'",
		37: "'~'",
		38: ">-<",
		39: ";P",
		40: "@_@",
		41: "Antly",
		42: "Bear",
		43: "Catgirl",
		44: "Classix",
		45: ":D",
	},
	Hand: {
		10: "Evolved Antenna",
		11: "Forget me NOT",
		12: "Golden Axe",
		13: "Ikebana",
		14: "Insanity Catalyst",
		15: "Jordan",
		16: "K'nex",
		17: "Knife",
		18: "La Conica Espresso",
		19: "Lego Carrot",
		20: "March Hare",
		21: "Mexican Coke",
		22: "Ape Escape Net",
		23: "Phone Flail",
		24: "Porsche 911 Suspension",
		25: "Ribbon Staff",
		26: "Sirfetch'd",
		27: "Skylanders Sword",
		28: "Louisville Slugger",
		29: "Sly Cooper Cane",
		30: "Stygian Reaver",
		31: "Velvet Crowe",
		32: "Water Pistol",
		33: "Winged Staff Gold",
		34: "Aghanim's Scepter",
		35: "Balloon",
		36: "Boom Mic",
		37: "NewJeans MEGAPASS Advert Hammer",
		38: "American Flag",
		39: "Ancient Godsword",
		40: "Armed Threat",
		41: "Atarashiki-mura",
		42: "Bionicle Axe",
		43: "Blade of the Immortal",
		44: "Bludgeoning Angel",
		45: "Cattle Gun",
		46: "Dreamcast Fishing Controller",
		47: "Energy Sword",
	},
	Offhand: {
		10: "Cookie",
		11: "Daihatsu Midget",
		12: "FBI Badge",
		13: "Final Fantasy X",
		14: "Foobar",
		15: "G-Shock",
		16: "Dwarf Fortress Greek Cross Bedroom Blueprint",
		17: "Gutenberg Bible",
		18: "Ketamine",
		19: "Super Lovers Watch",
		20: "Luna Moth",
		21: "Teddy Bear Anniversary Coin",
		22: "Palette",
		23: "Pocket Pet",
		24: "Quad Damage",
		25: "Remilia Films",
		26: "Remilia Engineering",
		27: "RX-78",
		28: "Rayman M Steal Shield",
		29: "Shooting Star Emoji",
		30: "Submarine Cable",
		31: "Tokyo Manhole Cover",
		32: "Tornado 2",
		33: "Vax Pass",
		34: "Pokewalker",
		35: "xclock",
		36: "5 Yen",
		37: "Game & Watch",
		38: "Hauchiwa",
		39: "Remilia Crest",
		40: "48 Laws of Power",
		41: "American Express Platinum",
		42: "B&W Nautilus",
		43: "Beat Happening",
		44: "Beetle Game",
		45: "Beyblade Bootleg",
		46: "Briefcase",
		47: "Carlo Bugatti Chair",
		48: "Clover",
		49: "Adventures of Cookie & Cream",
	},
	Pilot: {
		10: "Milady",
		11: "Minifig",
		12: "Okashina Mikan Uwasa Fruit Juicer",
		13: "Snoopy Plush",
		14: "Rei",
		15: "Red Pikmin",
		16: "Rover",
		17: "Series 381 Super Yakumo",
		18: "Speed Racer",
		19: "Sprite Autograph",
		20: "Sprite Signature?",
		21: "Sprite's Milady",
		22: "Sprite MapleStory",
		23: "Stuart",
		24: "TiVo",
		25: "Zatsune Miku",
		26: "Shakoki-Dogu Figma",
		27: "Guitarbear",
		28: "Hamtaro",
		29: "Incelroar",
		30: "Punkie",
		31: "Soulseek",
		32: "xNeko",
		33: "Alien Milady",
		34: "Beauty:Beast Bunny",
		35: "Binky",
		36: "Black Frost",
		37: "Charlie's Dog",
		38: "Dancing Man Emoji",
		39: "Doctor Kawashima",
		40: "Hammin",
		41: "Wolfie",
		42: "Kasane Teto",
	},
};

let money = "";
let bonklerName = "Bonkler";

document.addEventListener("DOMContentLoaded", function () {
	populateSelectors(data);
	document
		.getElementById("SaveBonkler")
		.addEventListener("click", handleSave);
	document
		.getElementById("BonklerMoney")
		.addEventListener("change", (event) => {
			handleMoney(event.target.value);
		});
	document
		.getElementById("creator-bonkler-name")
		.addEventListener("change", (event) => {
			handleName(event.target.value);
		});
	money = document.getElementById("BonklerMoney").value;
	bonklerName = document.getElementById("creator-bonkler-name").value;
	if (money != "") handleMoney(money);
});

function populateSelectors(data) {
	Object.entries(data).forEach(([category, options]) => {
		const selectElement = document.getElementById(category);
		if (!selectElement) return;

		Object.entries(options).forEach(([key, value]) => {
			const optionElement = document.createElement("option");
			optionElement.value = key; // Use the key (e.g., "10") as the option value
			optionElement.textContent = value; // Use the value (e.g., "Cookie") for display
			selectElement.appendChild(optionElement);
		});

		// Add event listener for when an option is selected
		selectElement.addEventListener("change", (event) => {
			const selectedKey = event.target.value;
			handleSelection(category, selectedKey); // Pass both category and selected key
		});
	});
}

const state = {
	BG: "00",
	Armor: "00",
	Body: "00",
	Head: "00",
	Face: "00",
	Hand: "00",
	Offhand: "00",
	Pilot: "00",
};

function handleSelection(category, key) {
	state[category] = key.padStart(2, "0");
	buildBonkler();
}

function buildBonkler() {
	const template = `${state.BG}${state.Armor}${state.Body}${state.Head}${state.Face}${state.Hand}${state.Offhand}${state.Pilot}`;
	const imageUrl = `https://bonklerimg.remilia.org/cgi-bin/bonklercgi?gen=${template}&meta=no&factor=4&reserve=${
		money != "" && money
	}`;
	document.getElementById("Bonkler").src = imageUrl;
}

function handleMoney(value) {
	const gwei = 1e18;
	const percent = (70 / 100) * value;
	money = percent * gwei;
	buildBonkler();
}

function handleName(value) {
	bonklerName = value;
}

function handleSave() {
	const canvas = document.createElement("canvas");
	const ctx = canvas.getContext("2d");
	const img = new Image();

	img.crossOrigin = "Anonymous"; // Attempt to request CORS permission
	img.onload = function () {
		canvas.width = img.width;
		canvas.height = img.height;
		ctx.drawImage(img, 0, 0);
		const dataURL = canvas.toDataURL("image/png");

		const element = document.createElement("a");
		element.setAttribute("href", dataURL);
		element.setAttribute("download", `${bonklerName}.png`);
		document.body.appendChild(element);
		element.click();
		document.body.removeChild(element);
	};
	img.src = document.getElementById("Bonkler").src; // The external image URL
}
