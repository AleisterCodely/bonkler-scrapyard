const data = {
	BG: [
		{ key: "33", value: "Akiko Yano Tadaima" },
		{ key: "34", value: "Analord 11" },
		{ key: "35", value: "Aquarium" },
		{ key: "36", value: "Athens" },
		{ key: "37", value: "Banknote" },
		{ key: "38", value: "Blender Hotel Prague" },
		{ key: "39", value: "Bonkler St" },
		{ key: "40", value: "Bonkler in His Gallery" },
		{ key: "41", value: "Britney" },
		{ key: "42", value: "Cactus" },
		{ key: "10", value: "China" },
		{ key: "11", value: "Conical" },
		{ key: "12", value: "Dungeon" },
		{ key: "13", value: "Flatland" },
		{ key: "14", value: "Garden" },
		{ key: "32", value: "Gosenzo-sama Banbanzai!" },
		{ key: "15", value: "HDR Room" },
		{ key: "16", value: "Ikebana Backdrop" },
		{ key: "17", value: "It'll All Be Over" },
		{ key: "18", value: "Kimi Ni Mune Kyun" },
		{ key: "19", value: "Kings Field II" },
		{ key: "20", value: "Laminated Card" },
		{ key: "21", value: "Mega Bonkler On Earth" },
		{ key: "22", value: "Milady World" },
		{ key: "23", value: "Quest" },
		{ key: "24", value: "Shochiku Company" },
		{ key: "25", value: "Sonic 4" },
		{ key: "26", value: "Sour Grapes" },
		{ key: "27", value: "Sunflower Fields Forever" },
		{ key: "28", value: "Sunset" },
		{ key: "29", value: "Super Monkey Ball 2" },
		{ key: "30", value: "The Hole" },
		{ key: "31", value: "The Moon Zone" },
	],
	Armor: [
		{ key: "24", value: "Adamantine" },
		{ key: "23", value: "Adamantine Trim" },
		{ key: "26", value: "Black" },
		{ key: "25", value: "Black Trim" },
		{ key: "28", value: "Bronze" },
		{ key: "27", value: "Bronze Trim" },
		{
			key: "29",
			value: "Comme Des Garcons Homme Plus FW18 Dover Street Market Installation Dinosaur Bones",
		},
		{ key: "30", value: "Dragon" },
		{ key: "31", value: "Glory" },
		{ key: "32", value: "Handycam" },
		{ key: "10", value: "Harajuku Sticker" },
		{ key: "12", value: "Iron" },
		{ key: "11", value: "Iron Trim" },
		{ key: "13", value: "Jade" },
		{ key: "15", value: "Mithril" },
		{ key: "14", value: "Mithril Trim" },
		{ key: "16", value: "Phantom" },
		{ key: "18", value: "Steel" },
		{ key: "17", value: "Steel Trim" },
		{ key: "20", value: "Terminator" },
		{ key: "19", value: "Terminator Recolor" },
		{ key: "22", value: "White" },
		{ key: "21", value: "White Trim" },
	],
	Head: [
		{ key: "41", value: "Arcade Stick" },
		{ key: "46", value: "Asus W5Fe" },
		{ key: "47", value: "Bear Statue" },
		{ key: "48", value: "Beauty:Beast CD" },
		{ key: "45", value: "Blender Sphere" },
		{ key: "50", value: "Buddha Machine" },
		{ key: "51", value: "Bwooom Cube" },
		{ key: "52", value: "Chicken Sandwich" },
		{ key: "53", value: "Dreameye" },
		{ key: "54", value: "E-Meter" },
		{ key: "10", value: "Extraplanar Lens" },
		{ key: "11", value: "Fire" },
		{ key: "12", value: "Fish Shaped Ice Cream" },
		{ key: "13", value: "Flame Emoji" },
		{ key: "14", value: "GUN!!!" },
		{ key: "15", value: "GameCube" },
		{ key: "42", value: "Herring Brain Box" },
		{ key: "43", value: "iDog" },
		{ key: "26", value: "Jellycat Sun" },
		{ key: "16", value: "Jiangshan Cigarettes" },
		{ key: "17", value: "Joli Cat" },
		{ key: "18", value: "Kaossilator" },
		{ key: "19", value: "Konata" },
		{ key: "20", value: "Le Creuset" },
		{ key: "21", value: "Lego Head" },
		{ key: "22", value: "Logitech MX Master 3" },
		{ key: "23", value: "Mac Aquarium" },
		{ key: "25", value: "Media Tab 04.29.22" },
		{ key: "24", value: "Media Tab 06.16.22" },
		{ key: "35", value: "Mysterious" },
		{ key: "27", value: "N-Gage" },
		{ key: "29", value: "Neuro Fuzzy" },
		{ key: "28", value: "Nintendo DS" },
		{ key: "44", value: "Pacemaker" },
		{ key: "30", value: "PlayStation Vita" },
		{ key: "49", value: "Shenzen DS" },
		{ key: "31", value: "SillyBandz" },
		{ key: "32", value: "Sony Egg Speaker" },
		{ key: "33", value: "Square Pretzel" },
		{ key: "34", value: "Starfish" },
		{ key: "36", value: "Strawberry Hat" },
		{ key: "37", value: "Technics Record Player" },
		{ key: "38", value: "Water Hoop Game" },
		{ key: "39", value: "Wonder Vise" },
		{ key: "40", value: "YMO" },
	],
	Body: [
		{ key: "32", value: "#BASEDRETARDGANG Vol. 1" },
		{ key: "35", value: "$2 Phone" },
		{ key: "31", value: "Another Freaking Mech" },
		{ key: "37", value: "Beetle in Resin" },
		{ key: "38", value: "Boxed Garage Kit" },
		{ key: "12", value: "Burger Bonkler Laser" },
		{ key: "26", value: "Chinese Sprite" },
		{ key: "39", value: "Cosmic Ray Detectors" },
		{ key: "40", value: "Dark Magican Girl" },
		{ key: "13", value: "Fire Bonkler Laser" },
		{ key: "41", value: "Fragile Hearts" },
		{ key: "42", value: "Guam" },
		{ key: "43", value: "Harajuku Motorola" },
		{ key: "44", value: "Jacob Jensen T3" },
		{ key: "10", value: "Jade Cabbage" },
		{ key: "33", value: "Judd Chair" },
		{ key: "14", value: "Lego Skeleton" },
		{ key: "15", value: "Noctua Heatsink" },
		{ key: "16", value: "Orion Can" },
		{ key: "18", value: "Pelican Terminal" },
		{ key: "20", value: "Red and Blue Chair" },
		{ key: "21", value: "Rei Lighter" },
		{ key: "36", value: "Rilakkuma" },
		{ key: "22", value: "Rolliflex" },
		{ key: "34", value: "Rug" },
		{ key: "23", value: "Rummikub" },
		{ key: "24", value: "Sony CD Player" },
		{ key: "17", value: "Sony PVM" },
		{ key: "19", value: "Sony PocketStation" },
		{ key: "25", value: "Sony Tablet" },
		{ key: "27", value: "Suit" },
		{ key: "11", value: "Tekken King" },
		{ key: "28", value: "Valet Chair" },
		{ key: "29", value: "Vending Machine" },
		{ key: "30", value: "YMO Tour" },
	],
	Face: [
		{ key: "36", value: "'o'" },
		{ key: "37", value: "'~'" },
		{ key: "45", value: ":D" },
		{ key: "39", value: ";P" },
		{ key: "38", value: ">-<" },
		{ key: "30", value: ">_<" },
		{ key: "35", value: "?.?" },
		{ key: "40", value: "@_@" },
		{ key: "41", value: "Antly" },
		{ key: "42", value: "Bear" },
		{ key: "43", value: "Catgirl" },
		{ key: "44", value: "Classix" },
		{ key: "10", value: "Deal With It" },
		{ key: "11", value: "Evil" },
		{ key: "12", value: "Foobar" },
		{ key: "13", value: "Funko" },
		{ key: "14", value: "Gendo" },
		{ key: "15", value: "Grin" },
		{ key: "16", value: "Heh" },
		{ key: "17", value: "Jellycat" },
		{ key: "27", value: "Kaomoji" },
		{ key: "18", value: "Skele" },
		{ key: "19", value: "Star Struck" },
		{ key: "20", value: "Sunglasses" },
		{ key: "21", value: "T_T" },
		{ key: "22", value: "Telegram Duck Nerd" },
		{ key: "23", value: "Tough" },
		{ key: "24", value: "Walrus" },
		{ key: "25", value: "X" },
		{ key: "26", value: "Yotsuba Clover" },
		{ key: "28", value: "^-^" },
		{ key: "29", value: "^�^" },
		{ key: "32", value: "hmph!" },
		{ key: "31", value: "n_n" },
		{ key: "33", value: "~.~" },
		{ key: "34", value: "�?�" },
	],
	Hand: [
		{ key: "34", value: "Aghanim's Scepter" },
		{ key: "38", value: "American Flag" },
		{ key: "39", value: "Ancient Godsword" },
		{ key: "22", value: "Ape Escape Net" },
		{ key: "40", value: "Armed Threat" },
		{ key: "41", value: "Atarashiki-mura" },
		{ key: "35", value: "Balloon" },
		{ key: "42", value: "Bionicle Axe" },
		{ key: "43", value: "Blade of the Immortal" },
		{ key: "44", value: "Bludgeoning Angel" },
		{ key: "36", value: "Boom Mic" },
		{ key: "45", value: "Cattle Gun" },
		{ key: "46", value: "Dreamcast Fishing Controller" },
		{ key: "47", value: "Energy Sword" },
		{ key: "10", value: "Evolved Antenna" },
		{ key: "11", value: "Forget me NOT" },
		{ key: "12", value: "Golden Axe" },
		{ key: "13", value: "Ikebana" },
		{ key: "14", value: "Insanity Catalyst" },
		{ key: "15", value: "Jordan" },
		{ key: "16", value: "K'nex" },
		{ key: "17", value: "Knife" },
		{ key: "18", value: "La Conica Espresso" },
		{ key: "19", value: "Lego Carrot" },
		{ key: "28", value: "Louisville Slugger" },
		{ key: "20", value: "March Hare" },
		{ key: "21", value: "Mexican Coke" },
		{ key: "37", value: "NewJeans MEGAPASS Advert Hammer" },
		{ key: "23", value: "Phone Flail" },
		{ key: "24", value: "Porsche 911 Suspension" },
		{ key: "25", value: "Ribbon Staff" },
		{ key: "26", value: "Sirfetch'd" },
		{ key: "27", value: "Skylanders Sword" },
		{ key: "29", value: "Sly Cooper Cane" },
		{ key: "30", value: "Stygian Reaver" },
		{ key: "31", value: "Velvet Crowe" },
		{ key: "32", value: "Water Pistol" },
		{ key: "33", value: "Winged Staff Gold" },
	],
	Offhand: [
		{ key: "40", value: "48 Laws of Power" },
		{ key: "36", value: "5 Yen" },
		{ key: "49", value: "Adventures of Cookie & Cream" },
		{ key: "41", value: "American Express Platinum" },
		{ key: "42", value: "B&W Nautilus" },
		{ key: "43", value: "Beat Happening" },
		{ key: "44", value: "Beetle Game" },
		{ key: "45", value: "Beyblade Bootleg" },
		{ key: "46", value: "Briefcase" },
		{ key: "47", value: "Carlo Bugatti Chair" },
		{ key: "48", value: "Clover" },
		{ key: "10", value: "Cookie" },
		{ key: "11", value: "Daihatsu Midget" },
		{ key: "16", value: "Dwarf Fortress Greek Cross Bedroom Blueprint" },
		{ key: "12", value: "FBI Badge" },
		{ key: "13", value: "Final Fantasy X" },
		{ key: "14", value: "Foobar" },
		{ key: "15", value: "G-Shock" },
		{ key: "37", value: "Game & Watch" },
		{ key: "17", value: "Gutenberg Bible" },
		{ key: "38", value: "Hauchiwa" },
		{ key: "18", value: "Ketamine" },
		{ key: "20", value: "Luna Moth" },
		{ key: "22", value: "Palette" },
		{ key: "23", value: "Pocket Pet" },
		{ key: "34", value: "Pokewalker" },
		{ key: "24", value: "Quad Damage" },
		{ key: "27", value: "RX-78" },
		{ key: "28", value: "Rayman M Steal Shield" },
		{ key: "39", value: "Remilia Crest" },
		{ key: "26", value: "Remilia Engineering" },
		{ key: "25", value: "Remilia Films" },
		{ key: "29", value: "Shooting Star Emoji" },
		{ key: "30", value: "Submarine Cable" },
		{ key: "19", value: "Super Lovers Watch" },
		{ key: "21", value: "Teddy Bear Anniversary Coin" },
		{ key: "31", value: "Tokyo Manhole Cover" },
		{ key: "32", value: "Tornado 2" },
		{ key: "33", value: "Vax Pass" },
		{ key: "35", value: "xclock" },
	],
	Pilot: [
		{ key: "33", value: "Alien Milady" },
		{ key: "34", value: "Beauty:Beast Bunny" },
		{ key: "35", value: "Binky" },
		{ key: "36", value: "Black Frost" },
		{ key: "37", value: "Charlie's Dog" },
		{ key: "38", value: "Dancing Man Emoji" },
		{ key: "39", value: "Doctor Kawashima" },
		{ key: "27", value: "Guitarbear" },
		{ key: "40", value: "Hammin" },
		{ key: "28", value: "Hamtaro" },
		{ key: "29", value: "Incelroar" },
		{ key: "42", value: "Kasane Teto" },
		{ key: "10", value: "Milady" },
		{ key: "11", value: "Minifig" },
		{ key: "12", value: "Okashina Mikan Uwasa Fruit Juicer" },
		{ key: "30", value: "Punkie" },
		{ key: "15", value: "Red Pikmin" },
		{ key: "14", value: "Rei" },
		{ key: "16", value: "Rover" },
		{ key: "17", value: "Series 381 Super Yakumo" },
		{ key: "26", value: "Shakoki-Dogu Figma" },
		{ key: "13", value: "Snoopy Plush" },
		{ key: "31", value: "Soulseek" },
		{ key: "18", value: "Speed Racer" },
		{ key: "19", value: "Sprite Autograph" },
		{ key: "22", value: "Sprite MapleStory" },
		{ key: "20", value: "Sprite Signature?" },
		{ key: "21", value: "Sprite's Milady" },
		{ key: "23", value: "Stuart" },
		{ key: "24", value: "TiVo" },
		{ key: "41", value: "Wolfie" },
		{ key: "25", value: "Zatsune Miku" },
		{ key: "32", value: "xNeko" },
	],
};

let bonklerName = "Bonkler";
let templateState = {
	BG: "00",
	Armor: "00",
	Body: "00",
	Head: "00",
	Face: "00",
	Hand: "00",
	Offhand: "00",
	Pilot: "00",
};

document.addEventListener("DOMContentLoaded", function () {
	const saveButton = document.getElementById("SaveBonkler");
	const bonklerMoneyInput = document.getElementById("BonklerMoney");
	const bonklerNameInput = document.getElementById("creator-bonkler-name");
	const bonklerImage = document.getElementById("Bonkler");

	populateSelectors(data);
	saveButton.addEventListener("click", () =>
		handleSave(bonklerImage, bonklerName)
	);
	bonklerMoneyInput.addEventListener("change", (event) =>
		handleMoneyChange(event.target.value)
	);
	bonklerNameInput.addEventListener("change", (event) => {
		bonklerName = event.target.value || "Bonkler";
	});

	handleMoneyChange(bonklerMoneyInput.value);
	bonklerName = bonklerNameInput.value || "Bonkler";
});

function populateSelectors(data) {
	Object.entries(data).forEach(([category, options]) => {
		const selectElement = document.getElementById(category);
		if (!selectElement) return;

		options.forEach(({ key, value }) => {
			const optionElement = document.createElement("option");
			optionElement.value = key;
			optionElement.textContent = value;
			selectElement.appendChild(optionElement);
		});

		selectElement.addEventListener("change", (event) =>
			handleSelection(category, event.target.value)
		);
	});
}

function handleSelection(category, key) {
	templateState[category] = key.padStart(2, "0");
	buildBonkler();
}

function buildBonkler() {
	const template = Object.values(templateState).join("");
	const imageUrl = `https://bonklerimg.remilia.org/cgi-bin/bonklercgi?gen=${template}&meta=no&factor=4&reserve=${
		money || ""
	}`;
	document.getElementById("Bonkler").src = imageUrl;
}

function handleMoneyChange(value) {
	const gwei = 1e18;
	const val = value * gwei;
	money = Math.ceil((0.7 * val) / 1e15) * 1e15;
	console.log(money);
	buildBonkler();
}

function handleSave(bonklerImage, bonklerName) {
	const canvas = document.createElement("canvas");
	const ctx = canvas.getContext("2d");
	const img = new Image();

	img.crossOrigin = "Anonymous"; // Attempt to request CORS permission
	img.onload = function () {
		canvas.width = img.width;
		canvas.height = img.height;
		ctx.drawImage(img, 0, 0);
		const dataURL = canvas.toDataURL("image/png");

		const element = document.createElement("a");
		element.setAttribute("href", dataURL);
		element.setAttribute("download", `${bonklerName}.png`);
		document.body.appendChild(element);
		element.click();
		document.body.removeChild(element);
	};
	img.src = bonklerImage.src;
}
